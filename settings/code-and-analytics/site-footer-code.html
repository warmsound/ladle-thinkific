<style type="text/css">
    /* Set background image of entire course player, including behind header.
       Clear existing background colours. */
    .course-player {
        background: rgba(0, 0, 0, 0) !important;
    }
    .course-player > main > section {
        background: rgba(0, 0, 0, 0) !important;
    }
    #main-content {
        background: rgba(0, 0, 0, 0) !important;
    }
    #player-wrapper {
        background: url('https://raw.githubusercontent.com/warmsound/ladle-thinkific/master/resources/lesson-background.png');
    }
    
    /* Hard-code semi-transparent background colour for top bar. */
    .course-player__top-bar {
        background-color: rgba(27, 158, 234, 0.5) !important;
    }
</style>

<script type="text/javascript">
    // Send lesson completion data to Google Sheets.
    $(function() {
        if(typeof(CoursePlayerV2) !== 'undefined') {
            CoursePlayerV2.on('hooks:contentWasCompleted', function(data) {
                data.user = Thinkific.current_user;
                
                const URL = 'https://script.google.com/macros/s/AKfycbwjN5WYg9KqiBVssqNtFT4XvRoiqIS4L5hScAp8rNIMptOY4l4/exec';
                
                // Param names must match sheet headers.
                let params = {
                    sheet: 'lesson_completions',
                    email: data.user.email,
                    name: data.user.full_name,
                    user_id: data.user.id,
                    lesson: data.lesson.name,
                    lesson_id: data.lesson.id
                };

                let xhr = new XMLHttpRequest();
                xhr.open('GET', URL + '?' + formatParams(params));
                xhr.send();
                
                console.log(data);
                
                //ThinkificAnalytics.track("Custom Content Completed", data);
            });
        }
    });
    
    function formatParams(params) {
        return Object.keys(params)
            .map(function(key){
                return key + '=' + encodeURIComponent(params[key])
            })
            .join('&');
    }

    // Autopilot integration.
    (function(o){var b="https://api.autopilothq.com/anywhere/",t="12edc86250af4e64a982146c9bf7f9f6e7ed944cf4924a3c8db62aaab1bf0de4",a=window.AutopilotAnywhere={_runQueue:[],run:function(){this._runQueue.push(arguments);}},c=encodeURIComponent,s="SCRIPT",d=document,l=d.getElementsByTagName(s)[0],p="t="+c(d.title||"")+"&u="+c(d.location.href||"")+"&r="+c(d.referrer||""),j="text/javascript",z,y;if(!window.Autopilot) window.Autopilot=a;if(o.app) p="devmode=true&"+p;z=function(src,asy){var e=d.createElement(s);e.src=src;e.type=j;e.async=asy;l.parentNode.insertBefore(e,l);};y=function(){z(b+t+'?'+p,true);};if(window.attachEvent){window.attachEvent("onload",y);}else{window.addEventListener("load",y,false);}})({});

    // Segment integration.
    !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
    analytics.load("CqHOerUm8gocR9dwT9yZNFtt78jhM3uz");
    analytics.page();
    }}();
</script>

